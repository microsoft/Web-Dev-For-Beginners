<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "eb358f3f4c2c082f9f3a4f98efa1d337",
  "translation_date": "2025-10-24T13:52:56+00:00",
  "source_file": "5-browser-extension/3-background-tasks-and-performance/README.md",
  "language_code": "vi"
}
-->
# Dá»± Ã¡n Tiá»‡n Ã­ch TrÃ¬nh duyá»‡t Pháº§n 3: TÃ¬m hiá»ƒu vá» Nhiá»‡m vá»¥ Ná»n vÃ  Hiá»‡u suáº¥t

Báº¡n cÃ³ bao giá» tháº¯c máº¯c táº¡i sao má»™t sá»‘ tiá»‡n Ã­ch trÃ¬nh duyá»‡t láº¡i hoáº¡t Ä‘á»™ng nhanh nháº¡y vÃ  mÆ°á»£t mÃ , trong khi nhá»¯ng tiá»‡n Ã­ch khÃ¡c láº¡i cháº­m cháº¡p? BÃ­ máº­t náº±m á»Ÿ nhá»¯ng gÃ¬ diá»…n ra phÃ­a sau. Trong khi ngÆ°á»i dÃ¹ng nháº¥p chuá»™t xung quanh giao diá»‡n tiá»‡n Ã­ch cá»§a báº¡n, cÃ³ cáº£ má»™t tháº¿ giá»›i cÃ¡c quy trÃ¬nh ná»n Ä‘ang Ã¢m tháº§m quáº£n lÃ½ viá»‡c láº¥y dá»¯ liá»‡u, cáº­p nháº­t biá»ƒu tÆ°á»£ng vÃ  tÃ i nguyÃªn há»‡ thá»‘ng.

ÄÃ¢y lÃ  bÃ i há»c cuá»‘i cÃ¹ng trong loáº¡t bÃ i vá» tiá»‡n Ã­ch trÃ¬nh duyá»‡t, vÃ  chÃºng ta sáº½ lÃ m cho cÃ´ng cá»¥ theo dÃµi dáº¥u chÃ¢n carbon cá»§a báº¡n hoáº¡t Ä‘á»™ng mÆ°á»£t mÃ . Báº¡n sáº½ thÃªm cÃ¡c cáº­p nháº­t biá»ƒu tÆ°á»£ng Ä‘á»™ng vÃ  há»c cÃ¡ch phÃ¡t hiá»‡n cÃ¡c váº¥n Ä‘á» vá» hiá»‡u suáº¥t trÆ°á»›c khi chÃºng trá»Ÿ thÃ nh váº¥n Ä‘á» lá»›n. NÃ³ giá»‘ng nhÆ° viá»‡c tinh chá»‰nh má»™t chiáº¿c xe Ä‘ua - nhá»¯ng tá»‘i Æ°u hÃ³a nhá» cÃ³ thá»ƒ táº¡o ra sá»± khÃ¡c biá»‡t lá»›n trong cÃ¡ch má»i thá»© váº­n hÃ nh.

Khi hoÃ n thÃ nh, báº¡n sáº½ cÃ³ má»™t tiá»‡n Ã­ch Ä‘Æ°á»£c hoÃ n thiá»‡n vÃ  hiá»ƒu rÃµ cÃ¡c nguyÃªn táº¯c hiá»‡u suáº¥t giÃºp phÃ¢n biá»‡t cÃ¡c á»©ng dá»¥ng web tá»‘t vá»›i nhá»¯ng á»©ng dá»¥ng tuyá»‡t vá»i. HÃ£y cÃ¹ng khÃ¡m phÃ¡ tháº¿ giá»›i tá»‘i Æ°u hÃ³a trÃ¬nh duyá»‡t.

## CÃ¢u há»i trÆ°á»›c bÃ i há»c

[CÃ¢u há»i trÆ°á»›c bÃ i há»c](https://ff-quizzes.netlify.app/web/quiz/27)

### Giá»›i thiá»‡u

Trong cÃ¡c bÃ i há»c trÆ°á»›c, báº¡n Ä‘Ã£ xÃ¢y dá»±ng má»™t biá»ƒu máº«u, káº¿t ná»‘i nÃ³ vá»›i API vÃ  xá»­ lÃ½ viá»‡c láº¥y dá»¯ liá»‡u khÃ´ng Ä‘á»“ng bá»™. Tiá»‡n Ã­ch cá»§a báº¡n Ä‘ang dáº§n hÃ¬nh thÃ nh.

BÃ¢y giá» chÃºng ta cáº§n thÃªm nhá»¯ng chi tiáº¿t cuá»‘i cÃ¹ng - nhÆ° lÃ m cho biá»ƒu tÆ°á»£ng tiá»‡n Ã­ch thay Ä‘á»•i mÃ u sáº¯c dá»±a trÃªn dá»¯ liá»‡u carbon. Äiá»u nÃ y lÃ m tÃ´i nhá»› Ä‘áº¿n cÃ¡ch NASA pháº£i tá»‘i Æ°u hÃ³a má»i há»‡ thá»‘ng trÃªn tÃ u vÅ© trá»¥ Apollo. Há» khÃ´ng thá»ƒ lÃ£ng phÃ­ báº¥t ká»³ chu ká»³ hay bá»™ nhá»› nÃ o vÃ¬ hiá»‡u suáº¥t quyáº¿t Ä‘á»‹nh Ä‘áº¿n sá»± sá»‘ng cÃ²n. Máº·c dÃ¹ tiá»‡n Ã­ch trÃ¬nh duyá»‡t cá»§a chÃºng ta khÃ´ng quan trá»ng Ä‘áº¿n má»©c Ä‘Ã³, nhÆ°ng cÃ¡c nguyÃªn táº¯c tÆ°Æ¡ng tá»± váº«n Ã¡p dá»¥ng - mÃ£ hiá»‡u quáº£ táº¡o ra tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng tá»‘t hÆ¡n.

## Nhá»¯ng Ä‘iá»u cÆ¡ báº£n vá» hiá»‡u suáº¥t web

Khi mÃ£ cá»§a báº¡n cháº¡y hiá»‡u quáº£, má»i ngÆ°á»i thá»±c sá»± *cáº£m nháº­n* Ä‘Æ°á»£c sá»± khÃ¡c biá»‡t. Báº¡n biáº¿t khoáº£nh kháº¯c khi má»™t trang táº£i ngay láº­p tá»©c hoáº·c má»™t hoáº¡t áº£nh cháº¡y mÆ°á»£t mÃ ? ÄÃ³ lÃ  hiá»‡u suáº¥t tá»‘t Ä‘ang hoáº¡t Ä‘á»™ng.

Hiá»‡u suáº¥t khÃ´ng chá»‰ lÃ  vá» tá»‘c Ä‘á»™ - nÃ³ cÃ²n lÃ  viá»‡c táº¡o ra tráº£i nghiá»‡m web tá»± nhiÃªn thay vÃ¬ cá»“ng ká»nh vÃ  gÃ¢y khÃ³ chá»‹u. VÃ o nhá»¯ng ngÃ y Ä‘áº§u cá»§a mÃ¡y tÃ­nh, Grace Hopper ná»•i tiáº¿ng giá»¯ má»™t nanosecond (má»™t Ä‘oáº¡n dÃ¢y dÃ i khoáº£ng má»™t foot) trÃªn bÃ n lÃ m viá»‡c Ä‘á»ƒ minh há»a khoáº£ng cÃ¡ch Ã¡nh sÃ¡ng Ä‘i Ä‘Æ°á»£c trong má»™t pháº§n tá»· giÃ¢y. ÄÃ³ lÃ  cÃ¡ch bÃ  giáº£i thÃ­ch táº¡i sao má»—i microsecond Ä‘á»u quan trá»ng trong tÃ­nh toÃ¡n. HÃ£y khÃ¡m phÃ¡ cÃ¡c cÃ´ng cá»¥ Ä‘iá»u tra giÃºp báº¡n tÃ¬m ra Ä‘iá»u gÃ¬ Ä‘ang lÃ m cháº­m má»i thá»©.

> "Hiá»‡u suáº¥t trang web lÃ  vá» hai Ä‘iá»u: tá»‘c Ä‘á»™ táº£i trang vÃ  tá»‘c Ä‘á»™ cháº¡y mÃ£ trÃªn Ä‘Ã³." -- [Zack Grossbart](https://www.smashingmagazine.com/2012/06/javascript-profiling-chrome-developer-tools/)

Chá»§ Ä‘á» vá» cÃ¡ch lÃ m cho trang web cá»§a báº¡n nhanh chÃ³ng trÃªn má»i loáº¡i thiáº¿t bá»‹, cho má»i loáº¡i ngÆ°á»i dÃ¹ng, trong má»i tÃ¬nh huá»‘ng, khÃ´ng cÃ³ gÃ¬ ngáº¡c nhiÃªn lÃ  ráº¥t rá»™ng lá»›n. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ Ä‘iá»ƒm cáº§n lÆ°u Ã½ khi báº¡n xÃ¢y dá»±ng má»™t dá»± Ã¡n web tiÃªu chuáº©n hoáº·c tiá»‡n Ã­ch trÃ¬nh duyá»‡t.

BÆ°á»›c Ä‘áº§u tiÃªn trong viá»‡c tá»‘i Æ°u hÃ³a trang web cá»§a báº¡n lÃ  hiá»ƒu nhá»¯ng gÃ¬ thá»±c sá»± Ä‘ang diá»…n ra bÃªn trong. May máº¯n thay, trÃ¬nh duyá»‡t cá»§a báº¡n cÃ³ cÃ¡c cÃ´ng cá»¥ Ä‘iá»u tra máº¡nh máº½ Ä‘Æ°á»£c tÃ­ch há»£p sáºµn.

Äá»ƒ má»Ÿ Developer Tools trong Edge, nháº¥p vÃ o ba dáº¥u cháº¥m á»Ÿ gÃ³c trÃªn bÃªn pháº£i, sau Ä‘Ã³ Ä‘i Ä‘áº¿n More Tools > Developer Tools. Hoáº·c sá»­ dá»¥ng phÃ­m táº¯t: `Ctrl` + `Shift` + `I` trÃªn Windows hoáº·c `Option` + `Command` + `I` trÃªn Mac. Khi báº¡n Ä‘Ã£ á»Ÿ Ä‘Ã³, nháº¥p vÃ o tab Performance - Ä‘Ã¢y lÃ  nÆ¡i báº¡n sáº½ thá»±c hiá»‡n Ä‘iá»u tra.

**Bá»™ cÃ´ng cá»¥ Ä‘iá»u tra hiá»‡u suáº¥t cá»§a báº¡n:**
- **Má»Ÿ** Developer Tools (báº¡n sáº½ sá»­ dá»¥ng chÃºng liÃªn tá»¥c vá»›i tÆ° cÃ¡ch lÃ  nhÃ  phÃ¡t triá»ƒn!)
- **Äi Ä‘áº¿n** tab Performance - hÃ£y nghÄ© vá» nÃ³ nhÆ° mÃ¡y theo dÃµi sá»©c khá»e cá»§a á»©ng dá»¥ng web cá»§a báº¡n
- **Nháº¥n** nÃºt Record vÃ  xem trang cá»§a báº¡n hoáº¡t Ä‘á»™ng
- **NghiÃªn cá»©u** káº¿t quáº£ Ä‘á»ƒ phÃ¡t hiá»‡n Ä‘iá»u gÃ¬ Ä‘ang lÃ m cháº­m má»i thá»©

HÃ£y thá»­ Ä‘iá»u nÃ y. Má»Ÿ má»™t trang web (Microsoft.com hoáº¡t Ä‘á»™ng tá»‘t cho viá»‡c nÃ y) vÃ  nháº¥p vÃ o nÃºt 'Record'. BÃ¢y giá» lÃ m má»›i trang vÃ  xem profiler ghi láº¡i má»i thá»© xáº£y ra. Khi báº¡n dá»«ng ghi, báº¡n sáº½ tháº¥y má»™t phÃ¢n tÃ­ch chi tiáº¿t vá» cÃ¡ch trÃ¬nh duyá»‡t 'scripts', 'renders', vÃ  'paints' trang web. NÃ³ lÃ m tÃ´i nhá»› Ä‘áº¿n cÃ¡ch trung tÃ¢m Ä‘iá»u khiá»ƒn giÃ¡m sÃ¡t má»i há»‡ thá»‘ng trong má»™t láº§n phÃ³ng tÃªn lá»­a - báº¡n nháº­n Ä‘Æ°á»£c dá»¯ liá»‡u thá»i gian thá»±c vá» chÃ­nh xÃ¡c nhá»¯ng gÃ¬ Ä‘ang xáº£y ra vÃ  khi nÃ o.

![Edge profiler](../../../../translated_images/profiler.5a4a62479c5df01cfec9aab74173dba13f91d2c968e1a1ae434c26165792df15.vi.png)

âœ… [TÃ i liá»‡u Microsoft](https://docs.microsoft.com/microsoft-edge/devtools-guide/performance/?WT.mc_id=academic-77807-sagibbon) cÃ³ ráº¥t nhiá»u chi tiáº¿t náº¿u báº¡n muá»‘n tÃ¬m hiá»ƒu sÃ¢u hÆ¡n

> Máº¹o chuyÃªn nghiá»‡p: XÃ³a bá»™ nhá»› cache cá»§a trÃ¬nh duyá»‡t trÆ°á»›c khi kiá»ƒm tra Ä‘á»ƒ xem trang web cá»§a báº¡n hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o Ä‘á»‘i vá»›i khÃ¡ch truy cáº­p láº§n Ä‘áº§u - thÆ°á»ng ráº¥t khÃ¡c so vá»›i nhá»¯ng láº§n truy cáº­p láº¡i!

Chá»n cÃ¡c pháº§n cá»§a dÃ²ng thá»i gian profile Ä‘á»ƒ phÃ³ng to cÃ¡c sá»± kiá»‡n xáº£y ra trong khi trang cá»§a báº¡n táº£i.

Láº¥y áº£nh chá»¥p nhanh hiá»‡u suáº¥t cá»§a trang báº±ng cÃ¡ch chá»n má»™t pháº§n cá»§a dÃ²ng thá»i gian profile vÃ  xem báº£ng tÃ³m táº¯t:

![Edge profiler snapshot](../../../../translated_images/snapshot.97750180ebcad73794a3594b36925eb5c8dbaac9e03fec7f9b974188c9ac63c7.vi.png)

Kiá»ƒm tra báº£ng Event Log Ä‘á»ƒ xem liá»‡u cÃ³ sá»± kiá»‡n nÃ o máº¥t hÆ¡n 15 ms:

![Edge event log](../../../../translated_images/log.804026979f3707e00eebcfa028b2b5a88cec6292f858767bb6703afba65a7d9c.vi.png)

âœ… LÃ m quen vá»›i profiler cá»§a báº¡n! Má»Ÿ cÃ´ng cá»¥ dÃ nh cho nhÃ  phÃ¡t triá»ƒn trÃªn trang web nÃ y vÃ  xem liá»‡u cÃ³ báº¥t ká»³ nÃºt tháº¯t cá»• chai nÃ o khÃ´ng. TÃ i nguyÃªn nÃ o táº£i cháº­m nháº¥t? Nhanh nháº¥t?

## Nhá»¯ng Ä‘iá»u cáº§n tÃ¬m khi profiling

Cháº¡y profiler chá»‰ lÃ  bÆ°á»›c khá»Ÿi Ä‘áº§u - ká»¹ nÄƒng thá»±c sá»± lÃ  biáº¿t nhá»¯ng biá»ƒu Ä‘á»“ Ä‘áº§y mÃ u sáº¯c Ä‘Ã³ thá»±c sá»± Ä‘ang nÃ³i gÃ¬ vá»›i báº¡n. Äá»«ng lo, báº¡n sáº½ quen vá»›i viá»‡c Ä‘á»c chÃºng. CÃ¡c nhÃ  phÃ¡t triá»ƒn cÃ³ kinh nghiá»‡m Ä‘Ã£ há»c cÃ¡ch phÃ¡t hiá»‡n cÃ¡c dáº¥u hiá»‡u cáº£nh bÃ¡o trÆ°á»›c khi chÃºng trá»Ÿ thÃ nh váº¥n Ä‘á» lá»›n.

HÃ£y nÃ³i vá» nhá»¯ng káº» gÃ¢y ráº¯c rá»‘i thÆ°á»ng gáº·p - nhá»¯ng váº¥n Ä‘á» vá» hiá»‡u suáº¥t thÆ°á»ng láº»n vÃ o cÃ¡c dá»± Ã¡n web. Giá»‘ng nhÆ° cÃ¡ch Marie Curie pháº£i cáº©n tháº­n theo dÃµi má»©c Ä‘á»™ phÃ³ng xáº¡ trong phÃ²ng thÃ­ nghiá»‡m cá»§a mÃ¬nh, chÃºng ta cáº§n theo dÃµi cÃ¡c máº«u nháº¥t Ä‘á»‹nh cho tháº¥y váº¥n Ä‘á» Ä‘ang hÃ¬nh thÃ nh. PhÃ¡t hiá»‡n sá»›m sáº½ giÃºp báº¡n (vÃ  ngÆ°á»i dÃ¹ng cá»§a báº¡n) trÃ¡nh Ä‘Æ°á»£c nhiá»u sá»± tháº¥t vá»ng.

**KÃ­ch thÆ°á»›c tÃ i nguyÃªn**: CÃ¡c trang web ngÃ y cÃ ng trá»Ÿ nÃªn "náº·ng" hÆ¡n qua cÃ¡c nÄƒm, vÃ  pháº§n lá»›n trá»ng lÆ°á»£ng thÃªm Ä‘Ã³ Ä‘áº¿n tá»« hÃ¬nh áº£nh. NÃ³ giá»‘ng nhÆ° chÃºng ta Ä‘ang nhá»“i nhÃ©t ngÃ y cÃ ng nhiá»u vÃ o vali ká»¹ thuáº­t sá»‘ cá»§a mÃ¬nh.

âœ… Kiá»ƒm tra [Internet Archive](https://httparchive.org/reports/page-weight) Ä‘á»ƒ xem kÃ­ch thÆ°á»›c trang Ä‘Ã£ tÄƒng lÃªn nhÆ° tháº¿ nÃ o theo thá»i gian - ráº¥t Ä‘Ã¡ng Ä‘á»ƒ khÃ¡m phÃ¡.

**CÃ¡ch giá»¯ cho tÃ i nguyÃªn cá»§a báº¡n Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a:**
- **NÃ©n** hÃ¬nh áº£nh! CÃ¡c Ä‘á»‹nh dáº¡ng hiá»‡n Ä‘áº¡i nhÆ° WebP cÃ³ thá»ƒ giáº£m kÃ­ch thÆ°á»›c tá»‡p Ä‘Ã¡ng ká»ƒ
- **Cung cáº¥p** kÃ­ch thÆ°á»›c hÃ¬nh áº£nh phÃ¹ há»£p cho tá»«ng thiáº¿t bá»‹ - khÃ´ng cáº§n gá»­i hÃ¬nh áº£nh lá»›n cho Ä‘iá»‡n thoáº¡i
- **RÃºt gá»n** CSS vÃ  JavaScript - tá»«ng byte Ä‘á»u quan trá»ng
- **Sá»­ dá»¥ng** lazy loading Ä‘á»ƒ hÃ¬nh áº£nh chá»‰ táº£i xuá»‘ng khi ngÆ°á»i dÃ¹ng thá»±c sá»± cuá»™n Ä‘áº¿n chÃºng

**DOM traversals**: TrÃ¬nh duyá»‡t pháº£i xÃ¢y dá»±ng MÃ´ hÃ¬nh Äá»‘i tÆ°á»£ng TÃ i liá»‡u (DOM) dá»±a trÃªn mÃ£ báº¡n viáº¿t, vÃ¬ váº­y Ä‘á»ƒ cÃ³ hiá»‡u suáº¥t trang tá»‘t, hÃ£y giá»¯ cÃ¡c tháº» cá»§a báº¡n á»Ÿ má»©c tá»‘i thiá»ƒu, chá»‰ sá»­ dá»¥ng vÃ  Ä‘á»‹nh kiá»ƒu nhá»¯ng gÃ¬ trang cáº§n. Äáº¿n Ä‘iá»ƒm nÃ y, CSS dÆ° thá»«a liÃªn quan Ä‘áº¿n má»™t trang cÃ³ thá»ƒ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a; cÃ¡c kiá»ƒu chá»‰ cáº§n sá»­ dá»¥ng trÃªn má»™t trang khÃ´ng cáº§n pháº£i Ä‘Æ°á»£c bao gá»“m trong tá»‡p style chÃ­nh, vÃ­ dá»¥.

**Chiáº¿n lÆ°á»£c chÃ­nh Ä‘á»ƒ tá»‘i Æ°u hÃ³a DOM:**
- **Giáº£m thiá»ƒu** sá»‘ lÆ°á»£ng pháº§n tá»­ HTML vÃ  má»©c Ä‘á»™ lá»“ng ghÃ©p
- **Loáº¡i bá»** cÃ¡c quy táº¯c CSS khÃ´ng sá»­ dá»¥ng vÃ  há»£p nháº¥t cÃ¡c tá»‡p stylesheet má»™t cÃ¡ch hiá»‡u quáº£
- **Tá»• chá»©c** CSS Ä‘á»ƒ chá»‰ táº£i nhá»¯ng gÃ¬ cáº§n thiáº¿t cho má»—i trang
- **Cáº¥u trÃºc** HTML má»™t cÃ¡ch ngá»¯ nghÄ©a Ä‘á»ƒ trÃ¬nh duyá»‡t phÃ¢n tÃ­ch tá»‘t hÆ¡n

**JavaScript**: Má»—i nhÃ  phÃ¡t triá»ƒn JavaScript nÃªn chÃº Ã½ Ä‘áº¿n cÃ¡c script 'render-blocking' pháº£i Ä‘Æ°á»£c táº£i trÆ°á»›c khi pháº§n cÃ²n láº¡i cá»§a DOM cÃ³ thá»ƒ Ä‘Æ°á»£c duyá»‡t vÃ  váº½ lÃªn trÃ¬nh duyá»‡t. HÃ£y cÃ¢n nháº¯c sá»­ dá»¥ng `defer` vá»›i cÃ¡c script ná»™i tuyáº¿n cá»§a báº¡n (nhÆ° Ä‘Ã£ lÃ m trong module Terrarium).

**Ká»¹ thuáº­t tá»‘i Æ°u hÃ³a JavaScript hiá»‡n Ä‘áº¡i:**
- **Sá»­ dá»¥ng** thuá»™c tÃ­nh `defer` Ä‘á»ƒ táº£i script sau khi DOM Ä‘Æ°á»£c phÃ¢n tÃ­ch
- **Thá»±c hiá»‡n** code splitting Ä‘á»ƒ chá»‰ táº£i JavaScript cáº§n thiáº¿t
- **Ãp dá»¥ng** lazy loading cho cÃ¡c chá»©c nÄƒng khÃ´ng quan trá»ng
- **Giáº£m thiá»ƒu** viá»‡c sá»­ dá»¥ng cÃ¡c thÆ° viá»‡n vÃ  framework náº·ng khi cÃ³ thá»ƒ

âœ… Thá»­ má»™t sá»‘ trang web trÃªn [Trang kiá»ƒm tra tá»‘c Ä‘á»™ trang web](https://www.webpagetest.org/) Ä‘á»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡c kiá»ƒm tra phá»• biáº¿n Ä‘Æ°á»£c thá»±c hiá»‡n Ä‘á»ƒ xÃ¡c Ä‘á»‹nh hiá»‡u suáº¥t trang web.

BÃ¢y giá» báº¡n Ä‘Ã£ cÃ³ Ã½ tÆ°á»Ÿng vá» cÃ¡ch trÃ¬nh duyá»‡t render cÃ¡c tÃ i nguyÃªn báº¡n gá»­i Ä‘áº¿n nÃ³, hÃ£y xem nhá»¯ng Ä‘iá»u cuá»‘i cÃ¹ng báº¡n cáº§n lÃ m Ä‘á»ƒ hoÃ n thiá»‡n tiá»‡n Ã­ch cá»§a mÃ¬nh:

### Táº¡o má»™t hÃ m Ä‘á»ƒ tÃ­nh toÃ¡n mÃ u sáº¯c

BÃ¢y giá» chÃºng ta sáº½ táº¡o má»™t hÃ m biáº¿n dá»¯ liá»‡u sá»‘ thÃ nh mÃ u sáº¯c cÃ³ Ã½ nghÄ©a. HÃ£y nghÄ© vá» nÃ³ nhÆ° má»™t há»‡ thá»‘ng Ä‘Ã¨n giao thÃ´ng - xanh cho nÄƒng lÆ°á»£ng sáº¡ch, Ä‘á» cho cÆ°á»ng Ä‘á»™ carbon cao.

HÃ m nÃ y sáº½ láº¥y dá»¯ liá»‡u CO2 tá»« API cá»§a chÃºng ta vÃ  xÃ¡c Ä‘á»‹nh mÃ u sáº¯c nÃ o tá»‘t nháº¥t Ä‘áº¡i diá»‡n cho tÃ¡c Ä‘á»™ng mÃ´i trÆ°á»ng. NÃ³ giá»‘ng nhÆ° cÃ¡ch cÃ¡c nhÃ  khoa há»c sá»­ dá»¥ng mÃ£ mÃ u trong báº£n Ä‘á»“ nhiá»‡t Ä‘á»ƒ hÃ¬nh dung cÃ¡c máº«u dá»¯ liá»‡u phá»©c táº¡p - tá»« nhiá»‡t Ä‘á»™ Ä‘áº¡i dÆ°Æ¡ng Ä‘áº¿n sá»± hÃ¬nh thÃ nh sao. HÃ£y thÃªm Ä‘iá»u nÃ y vÃ o `/src/index.js`, ngay sau cÃ¡c biáº¿n `const` mÃ  chÃºng ta Ä‘Ã£ thiáº¿t láº­p trÆ°á»›c Ä‘Ã³:

```javascript
function calculateColor(value) {
	// Define CO2 intensity scale (grams per kWh)
	const co2Scale = [0, 150, 600, 750, 800];
	// Corresponding colors from green (clean) to dark brown (high carbon)
	const colors = ['#2AA364', '#F5EB4D', '#9E4229', '#381D02', '#381D02'];

	// Find the closest scale value to our input
	const closestNum = co2Scale.sort((a, b) => {
		return Math.abs(a - value) - Math.abs(b - value);
	})[0];
	
	console.log(`${value} is closest to ${closestNum}`);
	
	// Find the index for color mapping
	const num = (element) => element > closestNum;
	const scaleIndex = co2Scale.findIndex(num);

	const closestColor = colors[scaleIndex];
	console.log(scaleIndex, closestColor);

	// Send color update message to background script
	chrome.runtime.sendMessage({ action: 'updateIcon', value: { color: closestColor } });
}
```

**HÃ£y phÃ¢n tÃ­ch hÃ m thÃ´ng minh nÃ y:**
- **Thiáº¿t láº­p** hai máº£ng - má»™t cho má»©c CO2, má»™t cho mÃ u sáº¯c (xanh = sáº¡ch, nÃ¢u = báº©n!)
- **TÃ¬m** káº¿t quáº£ gáº§n nháº¥t vá»›i giÃ¡ trá»‹ CO2 thá»±c táº¿ cá»§a chÃºng ta báº±ng cÃ¡ch sá»­ dá»¥ng má»™t sá»‘ sáº¯p xáº¿p máº£ng thÃ´ng minh
- **Láº¥y** mÃ u sáº¯c phÃ¹ há»£p báº±ng phÆ°Æ¡ng phÃ¡p findIndex()
- **Gá»­i** má»™t thÃ´ng bÃ¡o Ä‘áº¿n script ná»n cá»§a Chrome vá»›i mÃ u sáº¯c Ä‘Ã£ chá»n
- **Sá»­ dá»¥ng** template literals (nhá»¯ng dáº¥u backticks) Ä‘á»ƒ Ä‘á»‹nh dáº¡ng chuá»—i gá»n gÃ ng hÆ¡n
- **Giá»¯** má»i thá»© Ä‘Æ°á»£c tá»• chá»©c vá»›i cÃ¡c khai bÃ¡o const

API `chrome.runtime` [API](https://developer.chrome.com/extensions/runtime) giá»‘ng nhÆ° há»‡ tháº§n kinh cá»§a tiá»‡n Ã­ch cá»§a báº¡n - nÃ³ xá»­ lÃ½ táº¥t cáº£ cÃ¡c giao tiáº¿p vÃ  nhiá»‡m vá»¥ phÃ­a sau:

> "Sá»­ dá»¥ng API chrome.runtime Ä‘á»ƒ láº¥y trang ná»n, tráº£ vá» chi tiáº¿t vá» manifest, vÃ  láº¯ng nghe cÅ©ng nhÆ° pháº£n há»“i cÃ¡c sá»± kiá»‡n trong vÃ²ng Ä‘á»i cá»§a á»©ng dá»¥ng hoáº·c tiá»‡n Ã­ch. Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng API nÃ y Ä‘á»ƒ chuyá»ƒn Ä‘á»•i Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i cá»§a URL thÃ nh URL Ä‘áº§y Ä‘á»§."

**Táº¡i sao API Chrome Runtime láº¡i há»¯u Ã­ch:**
- **Cho phÃ©p** cÃ¡c pháº§n khÃ¡c nhau cá»§a tiá»‡n Ã­ch cá»§a báº¡n giao tiáº¿p vá»›i nhau
- **Xá»­ lÃ½** cÃ´ng viá»‡c ná»n mÃ  khÃ´ng lÃ m Ä‘Ã³ng bÄƒng giao diá»‡n ngÆ°á»i dÃ¹ng
- **Quáº£n lÃ½** cÃ¡c sá»± kiá»‡n vÃ²ng Ä‘á»i cá»§a tiá»‡n Ã­ch cá»§a báº¡n
- **LÃ m cho** viá»‡c truyá»n thÃ´ng Ä‘iá»‡p giá»¯a cÃ¡c script trá»Ÿ nÃªn dá»… dÃ ng

âœ… Náº¿u báº¡n Ä‘ang phÃ¡t triá»ƒn tiá»‡n Ã­ch trÃ¬nh duyá»‡t nÃ y cho Edge, cÃ³ thá»ƒ báº¡n sáº½ ngáº¡c nhiÃªn khi tháº¥y ráº±ng báº¡n Ä‘ang sá»­ dá»¥ng API chrome. CÃ¡c phiÃªn báº£n trÃ¬nh duyá»‡t Edge má»›i hÆ¡n cháº¡y trÃªn cÃ´ng cá»¥ trÃ¬nh duyá»‡t Chromium, vÃ¬ váº­y báº¡n cÃ³ thá»ƒ táº­n dá»¥ng cÃ¡c cÃ´ng cá»¥ nÃ y.

> **Máº¹o chuyÃªn nghiá»‡p**: Náº¿u báº¡n muá»‘n profiling má»™t tiá»‡n Ã­ch trÃ¬nh duyá»‡t, hÃ£y má»Ÿ cÃ´ng cá»¥ dÃ nh cho nhÃ  phÃ¡t triá»ƒn tá»« chÃ­nh tiá»‡n Ã­ch Ä‘Ã³, vÃ¬ nÃ³ lÃ  má»™t phiÃªn báº£n trÃ¬nh duyá»‡t riÃªng biá»‡t. Äiá»u nÃ y cung cáº¥p cho báº¡n quyá»n truy cáº­p vÃ o cÃ¡c sá»‘ liá»‡u hiá»‡u suáº¥t cá»¥ thá»ƒ cá»§a tiá»‡n Ã­ch.

### Äáº·t mÃ u biá»ƒu tÆ°á»£ng máº·c Ä‘á»‹nh

TrÆ°á»›c khi chÃºng ta báº¯t Ä‘áº§u láº¥y dá»¯ liá»‡u thá»±c, hÃ£y cung cáº¥p cho tiá»‡n Ã­ch cá»§a chÃºng ta má»™t Ä‘iá»ƒm khá»Ÿi Ä‘áº§u. KhÃ´ng ai thÃ­ch nhÃ¬n vÃ o má»™t biá»ƒu tÆ°á»£ng trá»‘ng hoáº·c trÃ´ng nhÆ° bá»‹ lá»—i. ChÃºng ta sáº½ báº¯t Ä‘áº§u vá»›i mÃ u xanh lÃ¡ cÃ¢y Ä‘á»ƒ ngÆ°á»i dÃ¹ng biáº¿t tiá»‡n Ã­ch Ä‘ang hoáº¡t Ä‘á»™ng ngay tá»« lÃºc há» cÃ i Ä‘áº·t.

Trong hÃ m `init()` cá»§a báº¡n, hÃ£y thiáº¿t láº­p mÃ u biá»ƒu tÆ°á»£ng máº·c Ä‘á»‹nh Ä‘Ã³:

```javascript
chrome.runtime.sendMessage({
	action: 'updateIcon',
	value: {
		color: 'green',
	},
});
```

**Nhá»¯ng gÃ¬ khá»Ÿi táº¡o nÃ y Ä‘áº¡t Ä‘Æ°á»£c:**
- **Äáº·t** mÃ u xanh lÃ¡ cÃ¢y trung tÃ­nh lÃ m tráº¡ng thÃ¡i máº·c Ä‘á»‹nh
- **Cung cáº¥p** pháº£n há»“i trá»±c quan ngay láº­p tá»©c khi tiá»‡n Ã­ch táº£i
- **Thiáº¿t láº­p** mÃ´ hÃ¬nh giao tiáº¿p vá»›i script ná»n
- **Äáº£m báº£o** ngÆ°á»i dÃ¹ng tháº¥y má»™t tiá»‡n Ã­ch hoáº¡t Ä‘á»™ng trÆ°á»›c khi dá»¯ liá»‡u táº£i

### Gá»i hÃ m, thá»±c thi lá»‡nh gá»i

BÃ¢y giá» hÃ£y káº¿t ná»‘i má»i thá»© láº¡i vá»›i nhau Ä‘á»ƒ khi dá»¯ liá»‡u CO2 má»›i Ä‘áº¿n, biá»ƒu tÆ°á»£ng cá»§a báº¡n tá»± Ä‘á»™ng cáº­p nháº­t vá»›i mÃ u sáº¯c phÃ¹ há»£p. NÃ³ giá»‘ng nhÆ° káº¿t ná»‘i máº¡ch cuá»‘i cÃ¹ng trong má»™t thiáº¿t bá»‹ Ä‘iá»‡n tá»­ - Ä‘á»™t nhiÃªn táº¥t cáº£ cÃ¡c thÃ nh pháº§n riÃªng láº» hoáº¡t Ä‘á»™ng nhÆ° má»™t há»‡ thá»‘ng.

ThÃªm dÃ²ng nÃ y ngay sau khi báº¡n láº¥y dá»¯ liá»‡u CO2 tá»« API:

```javascript
// After retrieving CO2 data from the API
// let CO2 = data.data[0].intensity.actual;
calculateColor(CO2);
```

**Sá»± tÃ­ch há»£p nÃ y Ä‘áº¡t Ä‘Æ°á»£c:**
- **Káº¿t ná»‘i** luá»“ng dá»¯ liá»‡u API vá»›i há»‡ thá»‘ng chá»‰ bÃ¡o trá»±c quan
- **KÃ­ch hoáº¡t** cáº­p nháº­t biá»ƒu tÆ°á»£ng tá»± Ä‘á»™ng khi dá»¯ liá»‡u má»›i Ä‘áº¿n
- **Äáº£m báº£o** pháº£n há»“i trá»±c quan theo thá»i gian thá»±c dá»±a trÃªn cÆ°á»ng Ä‘á»™ carbon hiá»‡n táº¡i
- **Duy trÃ¬** sá»± phÃ¢n tÃ¡ch giá»¯a logic láº¥y dá»¯ liá»‡u vÃ  hiá»ƒn thá»‹

VÃ  cuá»‘i cÃ¹ng, trong `/dist/background.js`, thÃªm trÃ¬nh láº¯ng nghe cho cÃ¡c cuá»™c gá»i hÃ nh Ä‘á»™ng ná»n nÃ y:

```javascript
// Listen for messages from the content script
chrome.runtime.onMessage.addListener(function (msg, sender, sendResponse) {
	if (msg.action === 'updateIcon') {
		chrome.action.setIcon({ imageData: drawIcon(msg.value) });
	}
});

// Draw dynamic icon using Canvas API
// Borrowed from energy lollipop extension - nice feature!
function drawIcon(value) {
	// Create an offscreen canvas for better performance
	const canvas = new OffscreenCanvas(200, 200);
	const context = canvas.getContext('2d');

	// Draw a colored circle representing carbon intensity
	context.beginPath();
	context.fillStyle = value.color;
	context.arc(100, 100, 50, 0, 2 * Math.PI);
	context.fill();

	// Return the image data for the browser icon
	return context.getImageData(50, 50, 100, 100);
}
```

**Script ná»n nÃ y lÃ m gÃ¬:**
- **Láº¯ng nghe** cÃ¡c thÃ´ng Ä‘iá»‡p tá»« script chÃ­nh cá»§a báº¡n (nhÆ° má»™t lá»… tÃ¢n nháº­n cuá»™c gá»i)
- **Xá»­ lÃ½** cÃ¡c yÃªu cáº§u 'updateIcon' Ä‘á»ƒ thay Ä‘á»•i biá»ƒu tÆ°á»£ng thanh cÃ´ng cá»¥ cá»§a báº¡n
- **Táº¡o** cÃ¡c biá»ƒu tÆ°á»£ng má»›i ngay láº­p tá»©c báº±ng cÃ¡ch sá»­ dá»¥ng Canvas API
- **Váº½** má»™t vÃ²ng trÃ²n mÃ u Ä‘Æ¡n giáº£n hiá»ƒn thá»‹ cÆ°á»ng Ä‘á»™ carbon hiá»‡n táº¡i
- **Cáº­p nháº­t** thanh cÃ´ng cá»¥ trÃ¬nh duyá»‡t cá»§a báº¡n vá»›i biá»ƒu tÆ°á»£ng má»›i
- **Sá»­ dá»¥ng** OffscreenCanvas Ä‘á»ƒ cÃ³ hiá»‡u suáº¥t mÆ°á»£t mÃ  (khÃ´ng lÃ m cháº·n giao diá»‡n ngÆ°á»i dÃ¹ng)

âœ… Báº¡n sáº½ tÃ¬m hiá»ƒu thÃªm vá» Canvas API trong [bÃ i há»c TrÃ² chÆ¡i KhÃ´ng gian](../../6-space-game/2-drawing-to-canvas/README.md).

**Thá»i gian kiá»ƒm tra tiá»‡n Ã­ch cá»§a báº¡n:**
- **XÃ¢y dá»±ng** má»i thá»© vá»›i `npm run build`
- **Táº£i láº¡i** tiá»‡n Ã­ch cá»§a báº¡n trong trÃ¬nh duyá»‡t (Ä‘á»«ng quÃªn bÆ°á»›c nÃ y)
- **Má»Ÿ** tiá»‡n Ã­ch cá»§a báº¡n vÃ  xem biá»ƒu tÆ°á»£ng Ä‘Ã³ thay Ä‘á»•i mÃ u sáº¯c
- **Kiá»ƒm tra** cÃ¡ch nÃ³ pháº£n há»“i vá»›i dá»¯ liá»‡u carbon thá»±c tá»« kháº¯p nÆ¡i trÃªn tháº¿ giá»›i

BÃ¢y giá» báº¡n sáº½ biáº¿t ngay láº­p tá»©c liá»‡u cÃ³ pháº£i thá»i Ä‘iá»ƒm tá»‘t Ä‘á»ƒ giáº·t Ä‘á»“ hay nÃªn chá» nÄƒng lÆ°á»£ng sáº¡ch hÆ¡n. Báº¡n vá»«a xÃ¢y dá»±ng má»™t thá»© thá»±c sá»± há»¯u Ã­ch vÃ  há»c Ä‘Æ°á»£c vá» hiá»‡u suáº¥t trÃ¬nh duyá»‡t trong quÃ¡ trÃ¬nh nÃ y.

## Thá»­ thÃ¡ch GitHub Copilot Agent ğŸš€

Sá»­ dá»¥ng cháº¿ Ä‘á»™ Agent Ä‘á»ƒ hoÃ n thÃ nh thá»­ thÃ¡ch sau:

**MÃ´ táº£:** NÃ¢ng cao kháº£ nÄƒng giÃ¡m sÃ¡t hiá»‡u suáº¥t cá»§a tiá»‡n Ã­ch trÃ¬nh duyá»‡t báº±ng cÃ¡ch thÃªm tÃ­nh nÄƒng theo dÃµi vÃ  hiá»ƒn thá»‹ thá»i gian táº£i cho cÃ¡c thÃ nh pháº§n khÃ¡c nhau cá»§a tiá»‡n Ã­ch.

**YÃªu cáº§u:** Táº¡o má»™t há»‡ thá»‘ng giÃ¡m sÃ¡t hiá»‡u suáº¥t cho tiá»‡n Ã­ch trÃ¬nh duyá»‡t Ä‘o lÆ°á»ng vÃ  ghi láº¡i thá»i gian láº¥y dá»¯ liá»‡u CO2 tá»« API, tÃ­nh toÃ¡n mÃ u sáº¯c, vÃ  cáº­p nháº­t biá»ƒu tÆ°á»£ng. ThÃªm má»™t hÃ m gá»i lÃ  `performanceTracker` sá»­ dá»¥ng Performance API Ä‘á»ƒ Ä‘o lÆ°á»ng cÃ¡c hoáº¡t Ä‘á»™ng nÃ y vÃ  hiá»ƒn thá»‹ káº¿t quáº£ trong console trÃ¬nh duyá»‡t vá»›i dáº¥u thá»i gian vÃ  sá»‘ liá»‡u thá»i gian.

TÃ¬m hiá»ƒu thÃªm vá» [cháº¿ Ä‘á»™ agent](https://code.visualstudio.com/blogs/2025/02/24/introducing-copilot-agent-mode) táº¡i Ä‘Ã¢y.

## ğŸš€ Thá»­ thÃ¡ch
ÄÃ¢y lÃ  má»™t nhiá»‡m vá»¥ thÃ¡m tá»­ thÃº vá»‹: chá»n má»™t vÃ i trang web mÃ£ nguá»“n má»Ÿ Ä‘Ã£ tá»“n táº¡i trong nhiá»u nÄƒm (nhÆ° Wikipedia, GitHub, hoáº·c Stack Overflow) vÃ  tÃ¬m hiá»ƒu lá»‹ch sá»­ cÃ¡c láº§n commit cá»§a há». Báº¡n cÃ³ thá»ƒ phÃ¡t hiá»‡n ra nÆ¡i há» Ä‘Ã£ cáº£i thiá»‡n hiá»‡u suáº¥t khÃ´ng? Nhá»¯ng váº¥n Ä‘á» nÃ o thÆ°á»ng xuyÃªn xuáº¥t hiá»‡n?

**CÃ¡ch tiáº¿p cáº­n Ä‘iá»u tra cá»§a báº¡n:**
- **TÃ¬m kiáº¿m** cÃ¡c thÃ´ng Ä‘iá»‡p commit vá»›i cÃ¡c tá»« nhÆ° "tá»‘i Æ°u hÃ³a," "hiá»‡u suáº¥t," hoáº·c "nhanh hÆ¡n"
- **Quan sÃ¡t** cÃ¡c máº«u - há» cÃ³ thÆ°á»ng xuyÃªn sá»­a chá»¯a cÃ¹ng má»™t loáº¡i váº¥n Ä‘á» khÃ´ng?
- **XÃ¡c Ä‘á»‹nh** cÃ¡c nguyÃªn nhÃ¢n phá»• biáº¿n lÃ m cháº­m trang web
- **Chia sáº»** nhá»¯ng gÃ¬ báº¡n khÃ¡m phÃ¡ - cÃ¡c nhÃ  phÃ¡t triá»ƒn khÃ¡c sáº½ há»c há»i tá»« cÃ¡c vÃ­ dá»¥ thá»±c táº¿

## CÃ¢u há»i sau bÃ i giáº£ng

[CÃ¢u há»i sau bÃ i giáº£ng](https://ff-quizzes.netlify.app/web/quiz/28)

## Ã”n táº­p & Tá»± há»c

HÃ£y cÃ¢n nháº¯c Ä‘Äƒng kÃ½ má»™t [báº£n tin vá» hiá»‡u suáº¥t](https://perf.email/)

KhÃ¡m phÃ¡ má»™t sá»‘ cÃ¡ch mÃ  cÃ¡c trÃ¬nh duyá»‡t Ä‘Ã¡nh giÃ¡ hiá»‡u suáº¥t web báº±ng cÃ¡ch xem qua cÃ¡c tab hiá»‡u suáº¥t trong cÃ´ng cá»¥ web cá»§a há». Báº¡n cÃ³ tÃ¬m tháº¥y sá»± khÃ¡c biá»‡t lá»›n nÃ o khÃ´ng?

## BÃ i táº­p

[PhÃ¢n tÃ­ch má»™t trang web vá» hiá»‡u suáº¥t](assignment.md)

---

**TuyÃªn bá»‘ miá»…n trá»« trÃ¡ch nhiá»‡m**:  
TÃ i liá»‡u nÃ y Ä‘Ã£ Ä‘Æ°á»£c dá»‹ch báº±ng dá»‹ch vá»¥ dá»‹ch thuáº­t AI [Co-op Translator](https://github.com/Azure/co-op-translator). Máº·c dÃ¹ chÃºng tÃ´i cá»‘ gáº¯ng Ä‘áº£m báº£o Ä‘á»™ chÃ­nh xÃ¡c, xin lÆ°u Ã½ ráº±ng cÃ¡c báº£n dá»‹ch tá»± Ä‘á»™ng cÃ³ thá»ƒ chá»©a lá»—i hoáº·c khÃ´ng chÃ­nh xÃ¡c. TÃ i liá»‡u gá»‘c báº±ng ngÃ´n ngá»¯ báº£n Ä‘á»‹a nÃªn Ä‘Æ°á»£c coi lÃ  nguá»“n thÃ´ng tin chÃ­nh thá»©c. Äá»‘i vá»›i thÃ´ng tin quan trá»ng, nÃªn sá»­ dá»¥ng dá»‹ch vá»¥ dá»‹ch thuáº­t chuyÃªn nghiá»‡p bá»Ÿi con ngÆ°á»i. ChÃºng tÃ´i khÃ´ng chá»‹u trÃ¡ch nhiá»‡m cho báº¥t ká»³ sá»± hiá»ƒu láº§m hoáº·c diá»…n giáº£i sai nÃ o phÃ¡t sinh tá»« viá»‡c sá»­ dá»¥ng báº£n dá»‹ch nÃ y.